var manifest=chrome.runtime.getManifest();var version=manifest.version;var url="https://www.quora.com/api/logged_in_user"+"?fields=inbox,notifs,update_interval"+"&version="+version;var updateIntervalMs=6e4;var minIntervalMs=3e4;var data={};var timeout;var clickDelayMs=2e3;function getData(){var request=$.ajax({url:url,dataType:"text",cache:false});request.done(function(msg){data.serverError=false;processResponse(msg)}).fail(function(msg){data.serverError=true})}function setBadgeText(text){chrome.browserAction.setBadgeText({text:text})}function processResponse(msg){var payload=msg.substring("while(1);".length);if(!payload.length){data.loggedIn=false;setBadgeText("");return}data=JSON.parse(payload);data.loggedIn=true;var text="";var inbox=data.inbox.unread_count;var notifs=data.notifs.unseen_count;var interval=data.update_interval_ms;if(notifs){text+=notifs.toString()}if(inbox){text+="/"+inbox.toString()}setBadgeText(text);if(interval&&interval>=minIntervalMs){updateIntervalMs=interval}}function update(){getData();timeout=setTimeout(update,updateIntervalMs)}update();chrome.runtime.onMessage.addListener(function(message,sender,sendResponse){if(message.getData){sendResponse(data)}else if(message.getUpdateInterval){sendResponse(updateIntervalMs)}else if(message.getUpdatedData){getData();sendResponse(data)}else if(message.clicked){clearTimeout(timeout);timeout=setTimeout(update,clickDelayMs)}});
